---
title: CS205 Assignment-Pandora Box
tags: C/C++
categories: CS
description: 頼むよ神様。 こんな人生だったんだ。 せめて一度くらい、幸せな梦を见させて。
---

### Background

{{<img src="https://s2.loli.net/2023/11/03/c9SLXKhob4CVzwU.png" alt="_RKU5WY0KCJ8K_XMQ41U85G.png" style="zoom: 33%;" >}}

<center><i><b><span style="color:#eb234b;">「奇迹ってのはタダじゃないんだ。希望を祈ればそれと同じ分だけの绝望が撒き散らされる。」</span></b></i></center>

<center><i><b><span style="color:#eb234b;">「そうやって差し引きを0にして 世の中のバランスは成り立ってるんだよ。」</span></b></i></center>

### Description

> This question is designed to examine your mastery of pointers using C for memory management. You can also use this question as an initial exploration of exception handling for your final project :)

Still frustrated that you can only put the same type of data in an STL vector? Missing Python's lists that can store any type of data? Now, try implementing a Pandora's Box that can store anything of any type in C!

<span style="color: rgb(51, 51, 51);">Ofcourse, GuTao is not so boring that letting everyone who is new to C write a complete Pandora's Box from scratch, that would be too difficult. So GuTao decided to give you the blueprint of the Pandora's Box, y</span>our task is just to implementseveral key operations to manage and interact with the `PandoraBox `structure.

The `PandoraBox` should provide the flexibility to append, write, and read data of different types, all stored within the same container.

In consideration of robustness, data written to the `PandoraBox` should be correctly handled even when its size doesn't match the item size, including handling data padding and negative values.

The following operations should be supported by your `PandoraBox` :

1.  `create`: Create an empty `PandoraBox` with specified item counts and their respective sizes.
2.  `append`: Extend the memory of the `PandoraBox` to append an item.
3.  `write`: Write data into a specific item within the `PandoraBox` .
4.  `read`: Copy the content of a particular item from the `PandoraBox` into newly allocated memory.
5.  `destroy`: Properly deallocate the memory associated with the `PandoraBox` and its data to prevent memory leaks.
6.  `printc`: Print bytes as characters in a given range, with proper handling of negative values.
7.  `printx`: Print bytes as a single hexadecimal value in a given range.
8.  `hex2byte`: Convert the given string to hexadecimal, and save it into the given address.

Ofcourse, GuTao is not so boring that letting everyone who is new to C write a complete Pandora's Box from scratch, that would be too difficult. So GuTao decided to give you the blueprint of the Pandora's Box, and you only need to implement a few simple functions.

### Input

~~Actually you don't need to worry about this part because the main function is given by GuTao.~~

The first line contains an integer $T$, the number of operations.

Then the following $T$ lines are operations.

- `C n a[0] a[1] ... a[n-1]`: create a Panbox with $n$ items, the sizes of items are $a[0]...a[n-1]$, split by spaces(All indices in this problem start from 0).
- `A l s`: append an item to the Panbox, where $l$ represents the length of a subsequent string, and $s$ represents the hexadecimal string, starting with "0x" and [a-f] in lowercase. For example, `A 9 0x514cafe`.
- `W i l s`: write the item with index $i$ with the value represented in the following hexadecimal string $s$ of length $l$.
- `R i o`: read the content of the item with index $i$. If $o$ is 1, then print the item in format of characters, otherwise in format of a single hexadecimal.
- `D`: Open the Pandora's box and free everything, including HOPE.
- `Q`: Display the information of the current Panbox.

### Output

~~Actually you don't need to worry about this part because the main function is given by GuTao.~~

- For `R` instructions, print the content of item[i] in the format given by $o$.
- For `Q` instructions, if the Panbox pointer is NULL, output NULL in a single line; otherwise the number of the items in the Panbox in a single line, then print the size of every item in a new line.
- For `D` instructions, print every item in character format, and in reverse order(FILO), then free the memory.

### Sample Input #1

```
12
C 1 4
W 0 10 0x45504f48
A 18 0x6e6f697469626d41
A 24 0x6e6f6974697465706d6f43
A 12 0x6465657247
A 10 0x79766e45
A 18 0x7973756f6c61654a
A 14 0x646572746148
A 20 0x6563697473756a6e49
A 20 0x797265686361657254
A 22 0x68746c6165682d6c6c49
D
```

### Sample Output #1

```
I l l - h e a l t h 
T r e a c h e r y 
I n j u s t i c e 
H a t r e d 
J e a l o u s y 
E n v y 
G r e e d 
C o m p e t i t i o n 
A m b i t i o n 
H O P E 
```

### Hint

To make this problem more interesting, `memcpy` and `memset`  of `<string.h>` are banned.

Try to implement them by your self!

```c
void *mycpy(void *dst, const void *src, size_t n);
void *myset(void *dst, int c, size_t n);
```

Also, this problem has NO Special Judge :)

### Template

<details>
    <summary>template code</summary>
    <figure class="highlight c"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">PandoraBox</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    <span class="type">int</span> item_count; <span class="comment">// Number of items stored in the PandoraBox.</span></span><br><span class="line">    <span class="type">int</span> *item_size; <span class="comment">// Array of item sizes in bytes.</span></span><br><span class="line">    <span class="type">void</span> *data;     <span class="comment">// A type-agnostic pointer to store data.</span></span><br><span class="line">} Panbox;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">A PandoraBox capable of storing various data types within a continuous memory space.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">- item_count: Number of items stored in this box.</span></span><br><span class="line"><span class="comment">- item_size: An array of integers; item_size[i] represents the size (in bytes) of the i-th item in the box.</span></span><br><span class="line"><span class="comment">- data: A type-agnostic pointer, enabling interpretation of different data types by reading segments with varying lengths.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*=+=+=+=+=+=+=+=+=+=+=Your code starts from here=+=+=+=+=+=+=+=+=+=+=*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">mycpy</span><span class="params">(<span class="type">void</span> *dst, <span class="type">const</span> <span class="type">void</span> *src, <span class="type">size_t</span> size)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: See memcpy in &lt;string.h&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- It is not a must to implement this function, but with it you can implement the following functions more easily.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">myset</span><span class="params">(<span class="type">void</span> *dst, <span class="type">int</span> n, <span class="type">size_t</span> size)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: See memset in &lt;string.h&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- It is not a must to implement this function, but with it you can implement the following functions more easily.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">Panbox *<span class="title function_">create</span><span class="params">(<span class="type">int</span> item_count, <span class="type">int</span> item_size[])</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: Create an empty PandoraBox with specified item counts and their respective sizes.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Parameters:</span></span><br><span class="line"><span class="comment">- item_count: The number of items to be stored in the PandoraBox.</span></span><br><span class="line"><span class="comment">- item_size: An array specifying the size (in bytes) of each item.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Returns:</span></span><br><span class="line"><span class="comment">A pointer to the created PandoraBox.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Note:</span></span><br><span class="line"><span class="comment">- You CAN create a Panbox with no initial items, i.e., item_count=0 and item_size=NULL.</span></span><br><span class="line"><span class="comment">- However, negative item_count is not supported, and item_size should not be NULL when item_count is non-zero.</span></span><br><span class="line"><span class="comment">- The size of any item should be positive.</span></span><br><span class="line"><span class="comment">- Make sure that the memory newly allocated is filled with 0s.</span></span><br><span class="line"><span class="comment">- You should return NULL immediately if any failure happens.</span></span><br><span class="line"><span class="comment">- Good news: GuTao guarantees that [item_size, item_size+item_count-1] is allocated in advance, unless item_size is NULL.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">append</span><span class="params">(Panbox *panbox, <span class="type">void</span> *value, <span class="type">int</span> width)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: Extend the memory of the PandoraBox to append an item.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Parameters:</span></span><br><span class="line"><span class="comment">- panbox: A pointer to the PandoraBox.</span></span><br><span class="line"><span class="comment">- value: A pointer to the data to be added to the PandoraBox.</span></span><br><span class="line"><span class="comment">- width: The size of the data in value (in bytes).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Note:</span></span><br><span class="line"><span class="comment">- You should not append this item if any failure happens.</span></span><br><span class="line"><span class="comment">- Good news: GuTao guarantees that [value, value+width-1] is allocated in advance, unless value is NULL.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">write</span><span class="params">(Panbox *panbox, <span class="type">int</span> item_id, <span class="type">void</span> *value, <span class="type">int</span> width)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: COPY the data stored in 'value' into the segment of the item with index item_id in the PandoraBox.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Parameters:</span></span><br><span class="line"><span class="comment">- panbox: A pointer to the PandoraBox.</span></span><br><span class="line"><span class="comment">- item_id: The index of the item in the PandoraBox where data will be written.</span></span><br><span class="line"><span class="comment">- value: A pointer to the data that needs to be written to the PandoraBox.</span></span><br><span class="line"><span class="comment">- width: The size of the data in value (in bytes).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- If 'item_id' is out of valid bounds, the data won't be written.</span></span><br><span class="line"><span class="comment">- If the item size cannot hold all data in value, the data won't be written.</span></span><br><span class="line"><span class="comment">- If the width of value is smaller than the item size, the data will be placed in the lower address and padded with the highest bit.</span></span><br><span class="line"><span class="comment">- Example: inserting a 1-byte value into a 2-byte item: (0x7f -&gt; 0x007f), (0xf7 -&gt; 0xfff7).</span></span><br><span class="line"><span class="comment">- The item_size should not change in this function.</span></span><br><span class="line"><span class="comment">- You should not write the item if any failure happens.</span></span><br><span class="line"><span class="comment">- Good news: GuTao guarantees that [value, value+width-1] is allocated in advance, unless value is NULL.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">read</span><span class="params">(Panbox *panbox, <span class="type">int</span> item_id)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: COPY the item with index item_id from the PandoraBox into a newly allocated memory, and return a pointer to this memory.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Parameters:</span></span><br><span class="line"><span class="comment">- panbox: A pointer to the PandoraBox.</span></span><br><span class="line"><span class="comment">- item_id: The index of the item in the PandoraBox that should be read.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Returns:</span></span><br><span class="line"><span class="comment">A pointer to the newly allocated memory containing a copy of the specified item.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- You should return NULL immediately if any failure happens.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">destroy</span><span class="params">(Panbox *panbox)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: Deallocate the memory associated with the PandoraBox and its data.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Parameters:</span></span><br><span class="line"><span class="comment">- panbox: A pointer to the PandoraBox that should be destroyed.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- This function should be used when the PandoraBox is no longer needed to prevent memory leak.</span></span><br><span class="line"><span class="comment">- You should check before freeing a pointer.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printc</span><span class="params">(<span class="type">void</span> *value, <span class="type">int</span> width)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: Print every 1 byte (char) in [value, value+width-1] as a character, split by a space.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- Good news: GuTao guarantees that [value, value+width-1] is allocated in advance, unless value is NULL.</span></span><br><span class="line"><span class="comment">- If the value of the byte is in [0, 32] or equals to 127(Del), do not print anything(they are special characters).</span></span><br><span class="line"><span class="comment">- e.g., for an empty box with all 0, the destroy of this box will invoke printc(), but should not print anything.</span></span><br><span class="line"><span class="comment">- If the value of the byte is negative, print '-' instead.</span></span><br><span class="line"><span class="comment">- You should return immediately if any failure happens.</span></span><br><span class="line"><span class="comment">- Please print a `\n` before returning, unless you print nothing in this function.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printx</span><span class="params">(<span class="type">void</span> *value, <span class="type">int</span> width)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: Print the value in [value, value+width-1] as a single hexadecimal, in format of 0x12345678.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- Good news: GuTao guarantees that [value, value+width-1] is allocated in advance, unless value is NULL.</span></span><br><span class="line"><span class="comment">- You should return immediately if any failure happens.</span></span><br><span class="line"><span class="comment">- If the highest byte is less than 0x10, please output a leading 0, e.g., 0x0514.</span></span><br><span class="line"><span class="comment">- Leading zeros are OK, if *(value) = 0x000f, width = 2, then print 0x000f. (print even number of characters)</span></span><br><span class="line"><span class="comment">- If the item is full of 0s, please still print it. E.g., 0x0000.</span></span><br><span class="line"><span class="comment">- Please print a `\n` before returning.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">hex2byte</span><span class="params">(<span class="type">void</span> *dst, <span class="type">char</span> *hex)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: For the given hex string "0x12345678", write 0x12345678 into dst.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- The length of hex might be ODD, make sure to put all data into dst. For example, "0xfff"(12 bits) should be stored using 2 bytes as 0x0fff(different from write(), just add a padding 0 here).</span></span><br><span class="line"><span class="comment">- You should return immediately if any failure happens.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*=+=+=+=+=+=+=+=+=+=+=Your code ends here=+=+=+=+=+=+=+=+=+=+=*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">show_info</span><span class="params">(Panbox *p)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, p-&gt;item_count);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; p-&gt;item_count; i++)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d "</span>, p-&gt;item_size[i]);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"NULL\n"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: Display the basic information of given PandoraBox</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Implemented by GuTao.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">Panbox *p = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--)</span><br><span class="line">    {</span><br><span class="line">        <span class="type">char</span> op;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">" %c"</span>, &amp;op);</span><br><span class="line">        <span class="keyword">switch</span> (op)</span><br><span class="line">        {</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'C'</span>: {</span><br><span class="line">            <span class="type">int</span> item_count;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;item_count);</span><br><span class="line">            <span class="type">int</span> *item_size = (<span class="type">int</span> *)<span class="built_in">malloc</span>(item_count * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; item_count; i++)</span><br><span class="line">            {</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;item_size[i]);</span><br><span class="line">            }</span><br><span class="line">            p = create(item_count, item_size);</span><br><span class="line">            <span class="built_in">free</span>(item_size);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'D'</span>: {</span><br><span class="line">            <span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> i = p-&gt;item_count - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">                {</span><br><span class="line">                    <span class="type">void</span> *data = read(p, i);</span><br><span class="line">                    <span class="keyword">if</span> (data != <span class="literal">NULL</span>)</span><br><span class="line">                    {</span><br><span class="line">                        printc(data, p-&gt;item_size[i]);</span><br><span class="line">                        <span class="built_in">free</span>(data);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            destroy(p);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'A'</span>: {</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;len);</span><br><span class="line">            <span class="type">char</span> *hex_str = (<span class="type">char</span> *)<span class="built_in">malloc</span>(len + <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, hex_str);</span><br><span class="line">            <span class="type">int</span> num_of_byte = (<span class="built_in">strlen</span>(hex_str) - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="type">void</span> *data = (<span class="type">void</span> *)<span class="built_in">malloc</span>(num_of_byte);</span><br><span class="line">            hex2byte(data, hex_str);</span><br><span class="line">            append(p, data, num_of_byte);</span><br><span class="line">            <span class="built_in">free</span>(hex_str);</span><br><span class="line">            <span class="built_in">free</span>(data);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'W'</span>: {</span><br><span class="line">            <span class="type">int</span> item_id;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;item_id);</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;len);</span><br><span class="line">            <span class="type">char</span> *hex_str = (<span class="type">char</span> *)<span class="built_in">malloc</span>(len + <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, hex_str);</span><br><span class="line">            <span class="type">int</span> num_of_byte = (<span class="built_in">strlen</span>(hex_str) - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="type">void</span> *data = (<span class="type">void</span> *)<span class="built_in">malloc</span>(num_of_byte);</span><br><span class="line">            hex2byte(data, hex_str);</span><br><span class="line">            write(p, item_id, data, num_of_byte);</span><br><span class="line">            <span class="built_in">free</span>(hex_str);</span><br><span class="line">            <span class="built_in">free</span>(data);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'R'</span>: {</span><br><span class="line">            <span class="type">int</span> item_id;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;item_id);</span><br><span class="line">            <span class="type">int</span> is_printc;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;is_printc);</span><br><span class="line">            <span class="type">void</span> *data = read(p, item_id);</span><br><span class="line">            <span class="keyword">if</span> (data != <span class="literal">NULL</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span> (is_printc)</span><br><span class="line">                {</span><br><span class="line">                    printc(data, p-&gt;item_size[item_id]);</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                {</span><br><span class="line">                    printx(data, p-&gt;item_size[item_id]);</span><br><span class="line">                }</span><br><span class="line">                <span class="built_in">free</span>(data);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'Q'</span>: {</span><br><span class="line">            show_info(p);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">default</span>: {</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Main function implemented by GuTao, you cannot rewrite one for yourself.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">- Just for you to understand how the functions you implement would be invoked.</span></span><br><span class="line"><span class="comment">- Not exact the main function to test on OJ, this one does not check your error handling.</span></span><br><span class="line"><span class="comment">- You can test your functions on your PC with your own main().</span></span><br><span class="line"><span class="comment">- You may want to hack with your own main function, but this won't help you AC :)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></div></figure>
</details>

### Test cases

1. NULL pointer handling for each function, create and destroy empty box.
2. Create, write items using data of exact lengths, read items, printc, destroy
3. Create, write items using data of exact lengths, read items, printc/x, destroy
4. Create, write items using data of random lengths, read items, printc, destroy, negative char
5. Create, write items using data of random lengths, read items, printc/x, destroy, negative char
6. Create, write items with invalid indices, append items, read items with invalid indices, printc, destroy
7. Create, write items with invalid indices, append items, read items with invalid indices, printc/x, destroy
8. Create, append items, write items, read items, printc/x, destroy, with full robustness
9. Memory leak check: (create, append items, destroy) *n
10. Large amount of create, append items, write items, read items, printc/x, destroy, with full robustness

### Standard Solution

<details>
    <summary>std by GuTao</summary>
    <figure class="highlight c"><div class="table-container"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Author: GuTao</span></span><br><span class="line"><span class="comment">Date:   2023-10-24</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Standard code for Assignment 2-1, CS205 C/C++ Program Design, 2023 Fall.</span></span><br><span class="line"><span class="comment">Although it is robust enough to pass this problem, there *must* be some bugs in this code.</span></span><br><span class="line"><span class="comment">Feel free to point them out in the QQ group!</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Sincere thanks to each of the you who worked hard challenging this question!</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">You may not get full marks on this problem, but at least you have a basic idea of how memory management and exception</span></span><br><span class="line"><span class="comment">handling works! Hope you enjoyed the process of exploring new ideas and debugging when challenging this problem.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Memory management is one of the eternal topics of learning C and C++, I hope that after this problem, you can always</span></span><br><span class="line"><span class="comment">pay attention to memory management and exception management in your future C/C++ development, whether it's an OJ problem</span></span><br><span class="line"><span class="comment">or a project.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Forgive me for the high level of robustness requirement for this assignment, after all, implementing a Pyhton-like list</span></span><br><span class="line"><span class="comment">in C is never a piece of cake, as the joke goes: A customer came to your bar, and ordered egg fried rice. I also hope</span></span><br><span class="line"><span class="comment">that you will do a good job of memory management and exception handling in your final project, which will be used as one</span></span><br><span class="line"><span class="comment">of the criteria for project evaluation.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Farewell, until we meet again at the final project :)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">GuTao</span></span><br><span class="line"><span class="comment">Nov. 19, 2023</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> memset main</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> memcpy main</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">PandoraBox</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    <span class="type">int</span> item_count; <span class="comment">// Number of items stored in the PandoraBox.</span></span><br><span class="line">    <span class="type">int</span> *item_size; <span class="comment">// Array of item sizes in bytes.</span></span><br><span class="line">    <span class="type">void</span> *data;     <span class="comment">// A type-agnostic pointer to store data.</span></span><br><span class="line">} Panbox;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">A PandoraBox capable of storing various data types within a continuous memory space.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">- item_count: Number of items stored in this box.</span></span><br><span class="line"><span class="comment">- item_size: An array of integers; item_size[i] represents the size (in bytes) of the i-th item in the box.</span></span><br><span class="line"><span class="comment">- data: A type-agnostic pointer, enabling interpretation of different data types by reading segments with varying</span></span><br><span class="line"><span class="comment">lengths.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">memory_checker</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IFRET(cond, ret)                                                                                               \</span></span><br><span class="line"><span class="meta">    do                                                                                                                 \</span></span><br><span class="line"><span class="meta">    {                                                                                                                  \</span></span><br><span class="line"><span class="meta">        <span class="keyword">if</span> (cond)                                                                                                      \</span></span><br><span class="line"><span class="meta">        {                                                                                                              \</span></span><br><span class="line"><span class="meta">            return ret;                                                                                                \</span></span><br><span class="line"><span class="meta">        }                                                                                                              \</span></span><br><span class="line"><span class="meta">    } while (0)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VIFRET(cond)                                                                                                   \</span></span><br><span class="line"><span class="meta">    do                                                                                                                 \</span></span><br><span class="line"><span class="meta">    {                                                                                                                  \</span></span><br><span class="line"><span class="meta">        <span class="keyword">if</span> (cond)                                                                                                      \</span></span><br><span class="line"><span class="meta">        {                                                                                                              \</span></span><br><span class="line"><span class="meta">            return;                                                                                                    \</span></span><br><span class="line"><span class="meta">        }                                                                                                              \</span></span><br><span class="line"><span class="meta">    } while (0)</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">mycpy</span><span class="params">(<span class="type">void</span> *dst, <span class="type">const</span> <span class="type">void</span> *src, <span class="type">size_t</span> size)</span></span><br><span class="line">{</span><br><span class="line"></span><br><span class="line">    IFRET(dst == <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    IFRET(src == <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="type">char</span> *psrc, *pdst;</span><br><span class="line">    <span class="keyword">if</span> ((src &lt; dst) &amp;&amp; (<span class="type">char</span> *)src + size &gt; (<span class="type">char</span> *)dst)</span><br><span class="line">    {</span><br><span class="line">        psrc = (<span class="type">char</span> *)src + size - <span class="number">1</span>;</span><br><span class="line">        pdst = (<span class="type">char</span> *)dst + size - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (size--)</span><br><span class="line">        {</span><br><span class="line">            *pdst-- = *psrc--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        psrc = (<span class="type">char</span> *)src;</span><br><span class="line">        pdst = (<span class="type">char</span> *)dst;</span><br><span class="line">        <span class="keyword">while</span> (size--)</span><br><span class="line">        {</span><br><span class="line">            *pdst++ = *psrc++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> pdst;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: See memcpy in &lt;string.h&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- It is not a must to implement this function, but with it you can implement the following functions more easily.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">myset</span><span class="params">(<span class="type">void</span> *dst, <span class="type">int</span> n, <span class="type">size_t</span> size)</span></span><br><span class="line">{</span><br><span class="line">    IFRET((dst == <span class="literal">NULL</span>), <span class="literal">NULL</span>);</span><br><span class="line">    <span class="type">char</span> *pdst = (<span class="type">char</span> *)dst;</span><br><span class="line">    <span class="keyword">while</span> (size--)</span><br><span class="line">    {</span><br><span class="line">        *pdst++ = n;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dst;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: See memset in &lt;string.h&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- It is not a must to implement this function, but with it you can implement the following functions more easily.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">Panbox *<span class="title function_">create</span><span class="params">(<span class="type">int</span> item_count, <span class="type">int</span> item_size[])</span></span><br><span class="line">{</span><br><span class="line">    IFRET(item_count &lt; <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">    IFRET(item_count &gt; <span class="number">0</span> &amp;&amp; item_size == <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    Panbox *p = (Panbox *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Panbox));</span><br><span class="line">    IFRET(p == <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    p-&gt;item_count = item_count;</span><br><span class="line">    p-&gt;item_size = (<span class="type">int</span> *)<span class="built_in">malloc</span>(item_count * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (p-&gt;item_size == <span class="literal">NULL</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">free</span>(p);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="type">size_t</span> data_size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; item_count; i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (item_size[i] &lt;= <span class="number">0</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">free</span>(p-&gt;item_size);</span><br><span class="line">            <span class="built_in">free</span>(p);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        }</span><br><span class="line">        p-&gt;item_size[i] = item_size[i];</span><br><span class="line">        data_size += item_size[i];</span><br><span class="line">    }</span><br><span class="line">    p-&gt;data = (<span class="type">void</span> *)<span class="built_in">malloc</span>(data_size);</span><br><span class="line">    myset(p-&gt;data, <span class="number">0</span>, data_size);</span><br><span class="line">    <span class="keyword">if</span> (p-&gt;data == <span class="literal">NULL</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">free</span>(p-&gt;item_size);</span><br><span class="line">        <span class="built_in">free</span>(p);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: Create an empty PandoraBox with specified item counts and their respective sizes.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Parameters:</span></span><br><span class="line"><span class="comment">- item_count: The number of items to be stored in the PandoraBox.</span></span><br><span class="line"><span class="comment">- item_size: An array specifying the size (in bytes) of each item.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Returns:</span></span><br><span class="line"><span class="comment">A pointer to the created PandoraBox.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Note:</span></span><br><span class="line"><span class="comment">- You CAN create a Panbox with no initial items, i.e., item_count=0.</span></span><br><span class="line"><span class="comment">- However, negative item_count is not supported, and item_size should not be NULL when item_count is non-zero.</span></span><br><span class="line"><span class="comment">- The size of any item should be positive.</span></span><br><span class="line"><span class="comment">- Make sure that the memory newly allocated is filled with 0s.</span></span><br><span class="line"><span class="comment">- You should return NULL immediately if any failure happens.</span></span><br><span class="line"><span class="comment">- Good news: GuTao guarantees that [item_size, item_size+item_count-1] is allocated in advance, unless item_size is</span></span><br><span class="line"><span class="comment">NULL.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">append</span><span class="params">(Panbox *panbox, <span class="type">const</span> <span class="type">void</span> *value, <span class="type">int</span> width)</span></span><br><span class="line">{</span><br><span class="line">    VIFRET(panbox == <span class="literal">NULL</span>);</span><br><span class="line">    VIFRET(panbox-&gt;data == <span class="literal">NULL</span>);</span><br><span class="line">    VIFRET(panbox-&gt;item_size == <span class="literal">NULL</span>);</span><br><span class="line">    VIFRET(panbox-&gt;item_count &lt; <span class="number">0</span>);</span><br><span class="line">    VIFRET(value == <span class="literal">NULL</span>);</span><br><span class="line">    VIFRET(width &lt;= <span class="number">0</span>);</span><br><span class="line">    <span class="type">size_t</span> data_size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; panbox-&gt;item_count; i++)</span><br><span class="line">    {</span><br><span class="line">        data_size += panbox-&gt;item_size[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> *new_size = (<span class="type">int</span> *)<span class="built_in">realloc</span>(panbox-&gt;item_size, <span class="keyword">sizeof</span>(<span class="type">int</span>) * (panbox-&gt;item_count + <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">if</span> (new_size == <span class="literal">NULL</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// item_size allocation failed</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        <span class="type">void</span> *new_data = (<span class="type">void</span> *)<span class="built_in">realloc</span>(panbox-&gt;data, data_size + width);</span><br><span class="line">        <span class="keyword">if</span> (new_data == <span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// data allocation failed, undo item_size extension</span></span><br><span class="line">            <span class="type">int</span> *tmp_size;</span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            {</span><br><span class="line">                tmp_size = (<span class="type">int</span> *)<span class="built_in">realloc</span>(new_size, <span class="keyword">sizeof</span>(<span class="type">int</span>) * (panbox-&gt;item_count));</span><br><span class="line">            } <span class="keyword">while</span> (tmp_size == <span class="literal">NULL</span>);</span><br><span class="line">            panbox-&gt;item_size = tmp_size;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// data allocation sucess</span></span><br><span class="line">            panbox-&gt;data = new_data;</span><br><span class="line">            panbox-&gt;item_count += <span class="number">1</span>;</span><br><span class="line">            panbox-&gt;item_size = new_size;</span><br><span class="line">            panbox-&gt;item_size[panbox-&gt;item_count - <span class="number">1</span>] = width;</span><br><span class="line">            mycpy(((<span class="type">char</span> *)panbox-&gt;data) + data_size, value, width);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: Extend the memory of the PandoraBox to append an item.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Parameters:</span></span><br><span class="line"><span class="comment">- panbox: A pointer to the PandoraBox.</span></span><br><span class="line"><span class="comment">- value: A pointer to the data to be added to the PandoraBox.</span></span><br><span class="line"><span class="comment">- width: The size of the data in value (in bytes).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Note:</span></span><br><span class="line"><span class="comment">- You should not append this item if any failure happens.</span></span><br><span class="line"><span class="comment">- Good news: GuTao guarantees that [value, value+width-1] is allocated in advance, unless value is NULL.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">write</span><span class="params">(Panbox *panbox, <span class="type">int</span> item_id, <span class="type">void</span> *value, <span class="type">int</span> width)</span></span><br><span class="line">{</span><br><span class="line">    VIFRET(panbox == <span class="literal">NULL</span>);</span><br><span class="line">    VIFRET(value == <span class="literal">NULL</span>);</span><br><span class="line">    VIFRET(width &lt;= <span class="number">0</span>);</span><br><span class="line">    VIFRET(item_id &lt; <span class="number">0</span> || item_id &gt;= panbox-&gt;item_count);</span><br><span class="line">    VIFRET(panbox-&gt;item_size[item_id] &lt; width);</span><br><span class="line">    <span class="type">size_t</span> data_size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; item_id; i++)</span><br><span class="line">    {</span><br><span class="line">        data_size += panbox-&gt;item_size[i];</span><br><span class="line">    }</span><br><span class="line">    mycpy(((<span class="type">char</span> *)panbox-&gt;data) + data_size, value, width);</span><br><span class="line">    <span class="keyword">if</span> (width &lt; panbox-&gt;item_size[item_id])</span><br><span class="line">    {</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> c = ((*((<span class="type">unsigned</span> <span class="type">char</span> *)value + width - <span class="number">1</span>)) &gt; <span class="number">0x7f</span>) ? <span class="number">0xff</span> : <span class="number">0x00</span>;</span><br><span class="line">        myset(((<span class="type">char</span> *)panbox-&gt;data) + data_size + width, c, panbox-&gt;item_size[item_id] - width);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: COPY the data stored in 'value' into the segment of the item with index item_id in the PandoraBox.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Parameters:</span></span><br><span class="line"><span class="comment">- panbox: A pointer to the PandoraBox.</span></span><br><span class="line"><span class="comment">- item_id: The index of the item in the PandoraBox where data will be written.</span></span><br><span class="line"><span class="comment">- value: A pointer to the data that needs to be written to the PandoraBox.</span></span><br><span class="line"><span class="comment">- width: The size of the data in value (in bytes).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- If 'item_id' is out of valid bounds, the data won't be written.</span></span><br><span class="line"><span class="comment">- If the item size cannot hold all data in value, the data won't be written.</span></span><br><span class="line"><span class="comment">- If the width of value is smaller than the item size, the data will be placed in the lower address and padded with the</span></span><br><span class="line"><span class="comment">highest bit.</span></span><br><span class="line"><span class="comment">- Example: inserting a 1-byte value into a 2-byte item: (0x7f -&gt; 0x007f), (0xf7 -&gt; 0xfff7).</span></span><br><span class="line"><span class="comment">- The item_size should not change in this function.</span></span><br><span class="line"><span class="comment">- You should not write the item if any failure happens.</span></span><br><span class="line"><span class="comment">- Good news: GuTao guarantees that [value, value+width-1] is allocated in advance, unless value is NULL.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">read</span><span class="params">(Panbox *panbox, <span class="type">int</span> item_id)</span></span><br><span class="line">{</span><br><span class="line">    IFRET(panbox == <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    IFRET(item_id &lt; <span class="number">0</span> || item_id &gt;= panbox-&gt;item_count, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="type">void</span> *data = (<span class="type">void</span> *)<span class="built_in">malloc</span>(panbox-&gt;item_size[item_id]);</span><br><span class="line">    <span class="keyword">if</span> (data != <span class="literal">NULL</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="type">char</span> *p = panbox-&gt;data;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; item_id; i++)</span><br><span class="line">        {</span><br><span class="line">            p = p + panbox-&gt;item_size[i];</span><br><span class="line">        }</span><br><span class="line">        mycpy(data, p, panbox-&gt;item_size[item_id]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: COPY the item with index item_id from the PandoraBox into a newly allocated memory, and return a pointer to</span></span><br><span class="line"><span class="comment">this memory.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Parameters:</span></span><br><span class="line"><span class="comment">- panbox: A pointer to the PandoraBox.</span></span><br><span class="line"><span class="comment">- item_id: The index of the item in the PandoraBox that should be read.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Returns:</span></span><br><span class="line"><span class="comment">A pointer to the newly allocated memory containing a copy of the specified item.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- You should return NULL immediately if any failure happens.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">destroy</span><span class="params">(Panbox *panbox)</span></span><br><span class="line">{</span><br><span class="line">    VIFRET(panbox == <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">free</span>(panbox-&gt;data);</span><br><span class="line">    panbox-&gt;data = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="built_in">free</span>(panbox-&gt;item_size);</span><br><span class="line">    panbox-&gt;item_size = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="built_in">free</span>(panbox);</span><br><span class="line">    panbox = <span class="literal">NULL</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: Deallocate the memory associated with the PandoraBox and its data.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Parameters:</span></span><br><span class="line"><span class="comment">- panbox: A pointer to the PandoraBox that should be destroyed.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- This function should be used when the PandoraBox is no longer needed to prevent memory leak.</span></span><br><span class="line"><span class="comment">- You should check before freeing a pointer.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printc</span><span class="params">(<span class="type">void</span> *value, <span class="type">int</span> width)</span></span><br><span class="line">{</span><br><span class="line">    VIFRET(value == <span class="literal">NULL</span>);</span><br><span class="line">    VIFRET(width &lt;= <span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> printed = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; width; i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> c = ((<span class="type">unsigned</span> <span class="type">char</span> *)value)[i];</span><br><span class="line">        <span class="keyword">if</span> (c &gt;= <span class="number">33</span> &amp;&amp; c != <span class="number">127</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%c "</span>, (c &gt; <span class="number">127</span>) ? <span class="string">'-'</span> : c);</span><br><span class="line">            printed = <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (printed)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: Print every 1 byte (char) in [value, value+width-1] as a character, split by a space.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- Good news: GuTao guarantees that [value, value+width-1] is allocated in advance, unless value is NULL.</span></span><br><span class="line"><span class="comment">- If the value of the byte is in [0, 32] or equals to 127(Del), do not print anything(they are special characters).</span></span><br><span class="line"><span class="comment">- e.g., for an empty box with all 0, the destroy of this box will invoke printc(), but should not print anything.</span></span><br><span class="line"><span class="comment">- If the value of the byte is negative, print '-' instead.</span></span><br><span class="line"><span class="comment">- You should return immediately if any failure happens.</span></span><br><span class="line"><span class="comment">- Please print a `\n` before returning, unless you print nothing in this function.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printx</span><span class="params">(<span class="type">void</span> *value, <span class="type">int</span> width)</span></span><br><span class="line">{</span><br><span class="line">    VIFRET(value == <span class="literal">NULL</span>);</span><br><span class="line">    VIFRET(width &lt;= <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"0x"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = width - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    {</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> c = ((<span class="type">unsigned</span> <span class="type">char</span> *)value)[i];</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%02x"</span>, c);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: Print the value in [value, value+width-1] as a single hexadecimal, in format of 0x12345678.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- Good news: GuTao guarantees that [value, value+width-1] is allocated in advance, unless value is NULL.</span></span><br><span class="line"><span class="comment">- You should return immediately if any failure happens.</span></span><br><span class="line"><span class="comment">- If the highest byte is less than 0x10, please output a leading 0, e.g., 0x0514.</span></span><br><span class="line"><span class="comment">- Leading zeros are OK, if *(value) = 0x000f, width = 2, then print 0x000f. (print even number of characters)</span></span><br><span class="line"><span class="comment">- If the item is full of 0s, please still print it. E.g., 0x0000.</span></span><br><span class="line"><span class="comment">- Please print a `\n` before returning, unless failure happens in this function.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">hex2int</span><span class="params">(<span class="type">char</span> c)</span></span><br><span class="line">{</span><br><span class="line">    IFRET(<span class="string">'0'</span> &lt;= c &amp;&amp; c &lt;= <span class="string">'9'</span>, c - <span class="string">'0'</span>);</span><br><span class="line">    IFRET(<span class="string">'a'</span> &lt;= c &amp;&amp; c &lt;= <span class="string">'f'</span>, c - <span class="string">'a'</span> + <span class="number">10</span>);</span><br><span class="line">    IFRET(<span class="string">'A'</span> &lt;= c &amp;&amp; c &lt;= <span class="string">'F'</span>, c - <span class="string">'A'</span> + <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">hex2byte</span><span class="params">(<span class="type">void</span> *dst, <span class="type">char</span> *hex)</span></span><br><span class="line">{</span><br><span class="line">    VIFRET(dst == <span class="literal">NULL</span>);</span><br><span class="line">    VIFRET(hex == <span class="literal">NULL</span>);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> *ptr = (<span class="type">unsigned</span> <span class="type">char</span> *)dst;</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">strlen</span>(hex);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = len - <span class="number">1</span>; i &gt;= <span class="number">1</span>; i -= <span class="number">2</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="type">char</span> lo = hex[i];</span><br><span class="line">        <span class="type">char</span> hi = hex[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (lo == <span class="string">'x'</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (hi == <span class="string">'x'</span>)</span><br><span class="line">        {</span><br><span class="line">            *(ptr) = hex2int(lo);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            *(ptr) = (hex2int(hi) &lt;&lt; <span class="number">4</span>) + hex2int(lo);</span><br><span class="line">        }</span><br><span class="line">        ptr++;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Function: For the given hex string "0x12345678", write 0x12345678 into dst.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Notes:</span></span><br><span class="line"><span class="comment">- The length of hex might be ODD, make sure to put all data into dst. For example, "0xfff"(12 bits) should be stored</span></span><br><span class="line"><span class="comment">using 2 bytes as 0x0fff(different from write(), just add a padding 0 here).</span></span><br><span class="line"><span class="comment">- You should return immediately if any failure happens.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">show_info</span><span class="params">(Panbox *p)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, p-&gt;item_count);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; p-&gt;item_count; i++)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d "</span>, p-&gt;item_size[i]);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"NULL\n"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Panbox *p = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// freopen("./testcases/gift.in", "r", stdin);</span></span><br><span class="line">    <span class="comment">// freopen("./testcases/gift.out", "w", stdout);</span></span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--)</span><br><span class="line">    {</span><br><span class="line">        <span class="type">char</span> op;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">" %c"</span>, &amp;op);</span><br><span class="line">        <span class="keyword">switch</span> (op)</span><br><span class="line">        {</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'C'</span>: {</span><br><span class="line">            <span class="type">int</span> item_count;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;item_count);</span><br><span class="line">            <span class="type">int</span> *item_size = (<span class="type">int</span> *)<span class="built_in">malloc</span>(item_count * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; item_count; i++)</span><br><span class="line">            {</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;item_size[i]);</span><br><span class="line">            }</span><br><span class="line">            p = create(item_count, item_size);</span><br><span class="line">            <span class="built_in">free</span>(item_size);</span><br><span class="line">            item_size = <span class="literal">NULL</span>;</span><br><span class="line">            <span class="comment">// show_info(p);</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'D'</span>: {</span><br><span class="line">            <span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> i = p-&gt;item_count - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">                {</span><br><span class="line">                    <span class="type">void</span> *data = read(p, i);</span><br><span class="line">                    <span class="keyword">if</span> (data != <span class="literal">NULL</span>)</span><br><span class="line">                    {</span><br><span class="line">                        <span class="comment">// printf("%d th item:", i);</span></span><br><span class="line">                        printc(data, p-&gt;item_size[i]);</span><br><span class="line">                    }</span><br><span class="line">                    <span class="built_in">free</span>(data);</span><br><span class="line">                    data = <span class="literal">NULL</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            destroy(p);</span><br><span class="line">            p = <span class="literal">NULL</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'A'</span>: {</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;len);</span><br><span class="line">            <span class="type">char</span> *hex_str = (<span class="type">char</span> *)<span class="built_in">malloc</span>(len + <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, hex_str);</span><br><span class="line">            <span class="type">int</span> num_of_byte = (<span class="built_in">strlen</span>(hex_str) - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="type">void</span> *data = (<span class="type">void</span> *)<span class="built_in">malloc</span>(num_of_byte * <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">            hex2byte(data, hex_str);</span><br><span class="line">            append(p, data, num_of_byte);</span><br><span class="line">            <span class="built_in">free</span>(hex_str);</span><br><span class="line">            hex_str = <span class="literal">NULL</span>;</span><br><span class="line">            <span class="built_in">free</span>(data);</span><br><span class="line">            data = <span class="literal">NULL</span>;</span><br><span class="line">            <span class="comment">// show_info(p);</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'W'</span>: {</span><br><span class="line">            <span class="type">int</span> item_id;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;item_id);</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;len);</span><br><span class="line">            <span class="type">char</span> *hex_str = (<span class="type">char</span> *)<span class="built_in">malloc</span>(len + <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, hex_str);</span><br><span class="line">            <span class="type">int</span> num_of_byte = (<span class="built_in">strlen</span>(hex_str) - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="type">void</span> *data = (<span class="type">void</span> *)<span class="built_in">malloc</span>(num_of_byte * <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">            hex2byte(data, hex_str);</span><br><span class="line">            write(p, item_id, data, num_of_byte);</span><br><span class="line">            <span class="built_in">free</span>(hex_str);</span><br><span class="line">            hex_str = <span class="literal">NULL</span>;</span><br><span class="line">            <span class="built_in">free</span>(data);</span><br><span class="line">            data = <span class="literal">NULL</span>;</span><br><span class="line">            <span class="comment">// show_info(p);</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'R'</span>: {</span><br><span class="line">            <span class="type">int</span> item_id;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;item_id);</span><br><span class="line">            <span class="type">int</span> is_printc;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;is_printc);</span><br><span class="line">            <span class="type">void</span> *data = read(p, item_id);</span><br><span class="line">            <span class="keyword">if</span> (data != <span class="literal">NULL</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span> (is_printc)</span><br><span class="line">                {</span><br><span class="line">                    printc(data, p-&gt;item_size[item_id]);</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                {</span><br><span class="line">                    printx(data, p-&gt;item_size[item_id]);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="built_in">free</span>(data);</span><br><span class="line">            data = <span class="literal">NULL</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'Q'</span>: {</span><br><span class="line">            show_info(p);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'M'</span>: {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"check result: %d\n"</span>, memory_checker());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">default</span>: {</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    fclose(<span class="built_in">stdin</span>);</span><br><span class="line">    fclose(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">memory_checker</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> is[<span class="number">3</span>] = {<span class="number">10</span>, <span class="number">20</span>, <span class="number">0</span>};</span><br><span class="line">    <span class="type">char</span> val[<span class="number">5</span>] = {<span class="string">'G'</span>, <span class="string">'u'</span>, <span class="string">'T'</span>, <span class="string">'a'</span>, <span class="string">'o'</span>};</span><br><span class="line">    Panbox *u = <span class="literal">NULL</span>;</span><br><span class="line">    destroy(u);</span><br><span class="line">    u = create(<span class="number">-1</span>, is); <span class="comment">// negative item_count, non-null item_size, should fail</span></span><br><span class="line">    IFRET(u != <span class="literal">NULL</span>, <span class="number">1</span>);</span><br><span class="line">    u = create(<span class="number">1</span>, <span class="literal">NULL</span>); <span class="comment">// positive item_count, null item_size, should fail</span></span><br><span class="line">    IFRET(u != <span class="literal">NULL</span>, <span class="number">2</span>);</span><br><span class="line">    u = create(<span class="number">0</span>, <span class="literal">NULL</span>); <span class="comment">// empty box, should success</span></span><br><span class="line">    IFRET(u == <span class="literal">NULL</span>, <span class="number">3</span>);</span><br><span class="line">    destroy(u);        <span class="comment">// Normal destroy</span></span><br><span class="line">    u = create(<span class="number">3</span>, is); <span class="comment">// item_size[2] = 0, fail</span></span><br><span class="line">    IFRET(u != <span class="literal">NULL</span>, <span class="number">4</span>);</span><br><span class="line">    u = create(<span class="number">2</span>, is); <span class="comment">// Normal create, should success</span></span><br><span class="line">    IFRET(u == <span class="literal">NULL</span>, <span class="number">5</span>);</span><br><span class="line">    show_info(u);         <span class="comment">// 2 \n 10 20</span></span><br><span class="line">    append(<span class="literal">NULL</span>, val, <span class="number">5</span>); <span class="comment">// fail</span></span><br><span class="line">    append(u, <span class="literal">NULL</span>, <span class="number">5</span>);   <span class="comment">// fail</span></span><br><span class="line">    show_info(u);         <span class="comment">// 2 \n 10 20</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++)</span><br><span class="line">    {</span><br><span class="line">        append(u, val, <span class="number">5</span>); <span class="comment">// success</span></span><br><span class="line">    }</span><br><span class="line">    show_info(u);                   <span class="comment">// 1002 \n 10 20 5 ... 5</span></span><br><span class="line">    write(<span class="literal">NULL</span>, <span class="number">0</span>, val, <span class="number">5</span>);         <span class="comment">// fail</span></span><br><span class="line">    write(u, <span class="number">-1</span>, val, <span class="number">5</span>);           <span class="comment">// fail</span></span><br><span class="line">    write(u, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">5</span>);           <span class="comment">// fail</span></span><br><span class="line">    write(u, <span class="number">0</span>, val, <span class="number">5</span>);            <span class="comment">// success</span></span><br><span class="line">    show_info(u);                   <span class="comment">// 1002 \n 10 20 5 ... 5</span></span><br><span class="line">    <span class="type">void</span> *read_out = read(<span class="literal">NULL</span>, <span class="number">0</span>); <span class="comment">// fail</span></span><br><span class="line">    IFRET(read_out != <span class="literal">NULL</span>, <span class="number">6</span>);</span><br><span class="line">    read_out = read(u, <span class="number">-1</span>); <span class="comment">// fail</span></span><br><span class="line">    IFRET(read_out != <span class="literal">NULL</span>, <span class="number">7</span>);</span><br><span class="line">    read_out = read(u, <span class="number">2</span>); <span class="comment">// success</span></span><br><span class="line">    IFRET(read_out == <span class="literal">NULL</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="built_in">free</span>(read_out);        <span class="comment">// p-&gt;data should not be freed</span></span><br><span class="line">    read_out = read(u, <span class="number">0</span>); <span class="comment">// success</span></span><br><span class="line">    printc(<span class="literal">NULL</span>, <span class="number">1</span>);       <span class="comment">// fail, no output</span></span><br><span class="line">    printc(read_out, <span class="number">0</span>);   <span class="comment">// fail, no output</span></span><br><span class="line">    printc(read_out, <span class="number">5</span>);   <span class="comment">// G u T a o</span></span><br><span class="line">    printx(<span class="literal">NULL</span>, <span class="number">1</span>);       <span class="comment">// fail, no output</span></span><br><span class="line">    printx(read_out, <span class="number">0</span>);   <span class="comment">// fail, no output</span></span><br><span class="line">    printx(read_out, <span class="number">5</span>);   <span class="comment">// 0x6f61547547</span></span><br><span class="line">    <span class="built_in">free</span>(read_out);</span><br><span class="line">    read_out = <span class="literal">NULL</span>;</span><br><span class="line">    destroy(u);</span><br><span class="line">    u = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></div></figure>
</details>
